function init(){camera=new THREE.PerspectiveCamera(75,SCREEN_WIDTH/SCREEN_HEIGHT,1,1e4),camera.position.z=500,scene=new THREE.Scene,birds=[],boids=[];for(var a=0;a<69;a++)boid=boids[a]=new Boid,boid.position.x=400*Math.random()-200,boid.position.y=400*Math.random()-200,boid.position.z=400*Math.random()-200,boid.velocity.x=2*Math.random()-1,boid.velocity.y=2*Math.random()-1,boid.velocity.z=2*Math.random()-1,boid.setAvoidWalls(!0),boid.setWorldSize(500,500,400),bird=birds[a]=new THREE.Mesh(new Bird,new THREE.MeshBasicMaterial({color:16777215*Math.random(),side:THREE.DoubleSide})),bird.phase=Math.floor(62.83*Math.random()),scene.add(bird);renderer=new THREE.CanvasRenderer,renderer.setClearColor(16777215),renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(SCREEN_WIDTH,SCREEN_HEIGHT),window.addEventListener("resize",onWindowResize,!0),document.addEventListener("mousemove",onDocumentMouseMove,!0),document.body.appendChild(renderer.domElement)}function onWindowResize(){camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)}function onDocumentMouseMove(a){for(var b=new THREE.Vector3(a.clientX-SCREEN_WIDTH_HALF,-a.clientY+SCREEN_HEIGHT_HALF,0),c=0,d=boids.length;c<d;c++)boid=boids[c],b.z=boid.position.z,boid.repulse(b)}function animate(){requestAnimationFrame(animate),render()}function render(){for(var a=0,b=birds.length;a<b;a++)boid=boids[a],boid.run(boids),bird=birds[a],bird.position.copy(boids[a].position),color=bird.material.color,color.r=color.g=color.b=(500-bird.position.z)/1e3,bird.rotation.y=Math.atan2(-boid.velocity.z,boid.velocity.x),bird.rotation.z=Math.asin(boid.velocity.y/boid.velocity.length()),bird.phase=(bird.phase+(Math.max(0,bird.rotation.z)+.1))%62.83,bird.geometry.vertices[5].y=bird.geometry.vertices[4].y=5*Math.sin(bird.phase);renderer.render(scene,camera)}var Boid=function(){var b,f,a=new THREE.Vector3,c=500,d=500,e=200,g=100,h=4,i=.1,j=!1;this.position=new THREE.Vector3,this.velocity=new THREE.Vector3,b=new THREE.Vector3,this.setGoal=function(a){f=a},this.setAvoidWalls=function(a){j=a},this.setWorldSize=function(a,b,f){c=a,d=b,e=f},this.run=function(f){j&&(a.set(-c,this.position.y,this.position.z),a=this.avoid(a),a.multiplyScalar(5),b.add(a),a.set(c,this.position.y,this.position.z),a=this.avoid(a),a.multiplyScalar(5),b.add(a),a.set(this.position.x,-d,this.position.z),a=this.avoid(a),a.multiplyScalar(5),b.add(a),a.set(this.position.x,d,this.position.z),a=this.avoid(a),a.multiplyScalar(5),b.add(a),a.set(this.position.x,this.position.y,-e),a=this.avoid(a),a.multiplyScalar(5),b.add(a),a.set(this.position.x,this.position.y,e),a=this.avoid(a),a.multiplyScalar(5),b.add(a)),Math.random()>.5&&this.flock(f),this.move()},this.flock=function(a){f&&b.add(this.reach(f,.005)),b.add(this.alignment(a)),b.add(this.cohesion(a)),b.add(this.separation(a))},this.move=function(){this.velocity.add(b);var a=this.velocity.length();a>h&&this.velocity.divideScalar(a/h),this.position.add(this.velocity),b.set(0,0,0)},this.checkBounds=function(){this.position.x>c&&(this.position.x=-c),this.position.x<-c&&(this.position.x=c),this.position.y>d&&(this.position.y=-d),this.position.y<-d&&(this.position.y=d),this.position.z>e&&(this.position.z=-e),this.position.z<-e&&(this.position.z=e)},this.avoid=function(a){var b=new THREE.Vector3;return b.copy(this.position),b.sub(a),b.multiplyScalar(1/this.position.distanceToSquared(a)),b},this.repulse=function(a){var c=this.position.distanceTo(a);if(c<150){var d=new THREE.Vector3;d.subVectors(this.position,a),d.multiplyScalar(.75/c),b.add(d)}},this.reach=function(a,b){var c=new THREE.Vector3;return c.subVectors(a,this.position),c.multiplyScalar(b),c},this.alignment=function(a){for(var b,c=new THREE.Vector3,d=0,e=0,f=a.length;e<f;e++)Math.random()>.6||(b=a[e],distance=b.position.distanceTo(this.position),distance>0&&distance<=g&&(c.add(b.velocity),d++));if(d>0){c.divideScalar(d);var h=c.length();h>i&&c.divideScalar(h/i)}return c},this.cohesion=function(a){for(var b,c,d=new THREE.Vector3,e=new THREE.Vector3,f=0,h=0,j=a.length;h<j;h++)Math.random()>.6||(b=a[h],c=b.position.distanceTo(this.position),c>0&&c<=g&&(d.add(b.position),f++));f>0&&d.divideScalar(f),e.subVectors(d,this.position);var k=e.length();return k>i&&e.divideScalar(k/i),e},this.separation=function(a){for(var b,c,d=new THREE.Vector3,e=new THREE.Vector3,f=0,h=a.length;f<h;f++)Math.random()>.6||(b=a[f],c=b.position.distanceTo(this.position),c>0&&c<=g&&(e.subVectors(this.position,b.position),e.normalize(),e.divideScalar(c),d.add(e)));return d}},SCREEN_WIDTH=window.innerWidth,SCREEN_HEIGHT=window.innerHeight,SCREEN_WIDTH_HALF=SCREEN_WIDTH/2,SCREEN_HEIGHT_HALF=SCREEN_HEIGHT/2,camera,scene,renderer,birds,bird,boid,boids;init(),animate();